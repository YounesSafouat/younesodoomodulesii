<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Extend portal template to redirect Pay Now buttons to Stripe payment link -->
        <template id="sale_order_portal_content_stripe" inherit_id="sale.sale_order_portal_content" name="Sale Order Portal Content - Stripe">
            <!-- Update sidebar Pay Now button href when Stripe link exists -->
            <xpath expr="//a[@id='o_sale_portal_paynow']" position="attributes">
                <attribute name="t-att-href">sale_order.stripe_payment_link_url if sale_order.stripe_payment_link_url else '#'</attribute>
                <attribute name="t-att-target">'_blank' if sale_order.stripe_payment_link_url else None</attribute>
                <attribute name="t-att-data-bs-toggle">None if sale_order.stripe_payment_link_url else 'modal'</attribute>
                <attribute name="t-att-data-bs-target">None if sale_order.stripe_payment_link_url else '#modalaccept'</attribute>
            </xpath>
            
            <!-- Update bottom Pay Now button href when Stripe link exists -->
            <xpath expr="//div[@name='sale_order_actions']//a[contains(@class, 'btn') and @data-bs-target='#modalaccept']" position="attributes">
                <attribute name="t-att-href">sale_order.stripe_payment_link_url if (sale_order.stripe_payment_link_url and not sale_order._has_to_be_signed()) else '#'</attribute>
                <attribute name="t-att-target">'_blank' if (sale_order.stripe_payment_link_url and not sale_order._has_to_be_signed()) else None</attribute>
                <attribute name="t-att-data-bs-toggle">None if (sale_order.stripe_payment_link_url and not sale_order._has_to_be_signed()) else 'modal'</attribute>
                <attribute name="t-att-data-bs-target">None if (sale_order.stripe_payment_link_url and not sale_order._has_to_be_signed()) else '#modalaccept'</attribute>
            </xpath>
        </template>
    </data>
</odoo>
